# 🚀 GAS レポーティングシステム - 既存スプレッドシート対応版

毎日午前9時に自動実行され、**既存のスプレッドシート**の構造を自動分析してレポートを生成するGoogle Apps Scriptシステムです。

## 🎯 主な特徴

### 🔍 **自動構造分析**
- 既存のスプレッドシートの構造を自動解析
- 列のデータ型を自動判定（日付、ステータス、カテゴリ、数値、テキスト）
- ヘッダー行の自動特定
- データパターンの分析

### 📊 **動的レポート生成**
- スプレッドシートの構造に応じたレポート生成
- 各データ型に最適化された分析
- 自動的なTODO事項の抽出
- 構造変更に自動対応

### 🔄 **完全自動化**
- 毎日午前9時の自動実行
- メール通知とスプレッドシート保存
- エラー時の自動通知
- 設定不要のプラグアンドプレイ

## 📋 対応するデータ構造

### 🗂️ **データ型の自動判定**
| データ型 | 判定基準 | 分析内容 |
|---------|----------|----------|
| **日付** | ヘッダーキーワード + 60%以上が日付形式 | 期限切れ、今後の予定 |
| **ステータス** | 限定値 + ステータス関連キーワード | 状態別集計、完了率 |
| **カテゴリ** | ユニーク値30%以下 + 10個以下 | カテゴリ別集計 |
| **数値** | 80%以上が数値 | 合計、平均、最大、最小 |
| **テキスト** | 上記以外 | 文字列分析 |

### 📊 **対応する用途例**
- **タスク管理**: 進捗状況、期限管理、担当者別分析
- **売上管理**: 売上集計、商品別分析、地域別比較
- **在庫管理**: 在庫状況、発注点管理、過不足分析
- **学習記録**: 学習時間、理解度、科目別分析
- **健康管理**: 数値トレンド、目標達成度
- **その他**: 任意の表形式データ

## 🚀 クイックスタート

### Step 1: 既存スプレッドシートの準備
```
✅ ヘッダー行があること
✅ データが一貫した形式で入力されていること
✅ 空のセルが少ないこと
```

### Step 2: Google Apps Scriptの設定
1. スプレッドシートで「拡張機能」→「Apps Script」
2. GitHubからファイルをコピー
3. 権限を承認

### Step 3: 自動セットアップ
```javascript
// 1. スプレッドシートIDを取得
getCurrentSpreadsheetId();

// 2. 設定を更新（Code.gsのCONFIG部分）
CONFIG.SPREADSHEET_ID = 'your_spreadsheet_id';
CONFIG.NOTIFICATION_EMAIL = 'your_email@example.com';

// 3. 自動セットアップ実行
quickSetup();
```

## 📁 プロジェクト構造

```
gas-reporting-system/
├── src/
│   ├── Code.gs              # メインプログラム
│   ├── SheetAnalyzer.gs     # 構造分析エンジン
│   ├── SetupUtilities.gs    # セットアップ用ユーティリティ
│   └── appsscript.json      # プロジェクト設定
├── docs/
│   └── SETUP_GUIDE.md       # 詳細セットアップガイド
├── examples/
│   └── sample-spreadsheet-structure.md  # サンプル構造例
└── README.md
```

## 🔧 主要機能

### 📊 **構造分析機能**
```javascript
// スプレッドシートの完全分析
analyzeSpreadsheetStructure()

// 分析結果の表示
displayStructureInfo()

// 分析結果をスプレッドシートに出力
outputStructureToSheet()
```

### 🧪 **テスト・デバッグ機能**
```javascript
// 設定の確認
checkConfiguration()

// テストレポートの生成
testReport()

// サンプルデータの生成
generateSampleData()

// トリガーの状態確認
checkTriggers()
```

### 🔄 **自動化機能**
```javascript
// 完全自動セットアップ
completeSetup()

// 日次トリガーの設定
setupDailyTrigger()

// メインレポート生成
main()
```

## 📈 生成されるレポート例

```
=================================
📊 日次レポート - 2024年01月16日
=================================

【📋 データ概要】
・スプレッドシート: タスク管理
・総データ数: 45
・分析列数: 6

【📈 詳細分析】

🔍 ステータス (status型):
  • 完了: 18件
  • 進行中: 15件
  • 未着手: 12件

🔍 期限 (date型):
  • 期限切れ: 3件
  • 今後7日以内: 8件
  • 総件数: 42件

🔍 担当者 (category型):
  • 田中: 12件
  • 佐藤: 10件
  • 鈴木: 8件

【📝 TODO事項】
• 期限切れ項目 3件の確認が必要
• 今後7日以内の期限 8件の進捗確認
• 未完了項目 27件の対応検討
=================================
```

## 🎯 ステップバイステップ セットアップ

### 1️⃣ **環境準備**
```bash
# 必要なもの：
- 既存のスプレッドシート（データ入力済み）
- Googleアカウント
- インターネット接続
```

### 2️⃣ **Apps Scriptプロジェクト作成**
1. 既存スプレッドシートを開く
2. 「拡張機能」→「Apps Script」を選択
3. 新規プロジェクトが作成される

### 3️⃣ **コードの配置**
```javascript
// 以下のファイルを作成してGitHubからコピー
1. Code.gs
2. SheetAnalyzer.gs  
3. SetupUtilities.gs
4. appsscript.json
```

### 4️⃣ **基本設定**
```javascript
// スプレッドシートIDを取得
getCurrentSpreadsheetId();

// 設定を更新
const CONFIG = {
  SPREADSHEET_ID: 'your_actual_spreadsheet_id',
  NOTIFICATION_EMAIL: 'your_email@example.com',
  DATA_SHEET_NAME: '',  // 空の場合は自動検出
  REPORT_SHEET_NAME: 'レポート'
};
```

### 5️⃣ **自動分析実行**
```javascript
// 構造分析 + テストレポート生成
quickSetup();

// 結果確認
// 1. 「構造分析」シートで分析結果を確認
// 2. 「レポート」シートでテストレポートを確認
```

### 6️⃣ **自動化設定**
```javascript
// 完全セットアップ（推奨）
completeSetup();

// または個別設定
setupDailyTrigger();  // 毎日午前9時実行
```

## 🔍 構造分析の仕組み

### **自動判定アルゴリズム**

1. **ヘッダー行の特定**
   - 最初の5行をチェック
   - 文字列が50%以上の行をヘッダーとする

2. **データ型の判定**
   - ヘッダーキーワードの分析
   - データパターンの統計分析
   - 信頼度スコアの計算

3. **分析結果の生成**
   - 各列の特性把握
   - 適切な分析手法の選択
   - レポート形式の決定

### **判定精度の向上**
```javascript
// データ品質改善のヒント
- 一貫した日付形式の使用
- ステータス値の統一
- 空のセルの最小化
- 数値データの正確な入力
```

## 🛠️ カスタマイズ

### **列の判定ルール調整**
```javascript
// SheetAnalyzer.gs で判定ルールを調整
function determineDataType(header, data, uniqueValues) {
  // カスタム判定ロジックを追加
}
```

### **レポート形式の変更**
```javascript
// Code.gs でレポート形式を調整
function generateReport(analysis, sheetStructure) {
  // カスタムレポート形式を実装
}
```

### **分析項目の追加**
```javascript
// 新しい分析項目を追加
function analyzeCustomData(data, column) {
  // カスタム分析ロジック
}
```

## 🔧 トラブルシューティング

### **よくある問題**

| 問題 | 原因 | 解決方法 |
|------|------|----------|
| 権限エラー | 初回実行時の権限不足 | スクリプトの権限を再承認 |
| 構造が認識されない | データが不完全 | `displayStructureInfo()`で確認 |
| レポートが生成されない | 設定ミス | `checkConfiguration()`で確認 |
| メールが届かない | アドレス設定ミス | CONFIGを確認 |

### **デバッグ手順**
```javascript
// 1. 設定確認
checkConfiguration();

// 2. 構造分析確認
displayStructureInfo();

// 3. テスト実行
testReport();

// 4. ログ確認
// Apps Scriptエディタの「実行トランスクリプト」を確認
```

## 📞 サポート

### **ヘルプ機能**
```javascript
// 利用可能な機能一覧
showHelp();
```

### **段階的サポート**
1. **基本**: `quickSetup()` → `testReport()`
2. **設定**: `checkConfiguration()` → `displayStructureInfo()`  
3. **完全**: `completeSetup()` → `main()`

## 📚 ドキュメント

- **[詳細セットアップガイド](docs/SETUP_GUIDE.md)** - 完全なセットアップ手順
- **[サンプル構造例](examples/sample-spreadsheet-structure.md)** - 対応可能な構造例

## 🎉 主な利点

### ✅ **導入の簡単さ**
- 既存データをそのまま使用
- 構造変更不要
- 自動設定

### ✅ **高い適応性**
- 様々なデータ形式に対応
- 動的な構造分析
- 柔軟なレポート生成

### ✅ **運用の自動化**
- 完全自動実行
- エラーハンドリング
- 通知機能

### ✅ **拡張性**
- カスタマイズ可能
- 新しい分析項目の追加
- 外部システム連携

## 🚀 今すぐ始める

```javascript
// 🎯 最短3ステップでスタート
1. getCurrentSpreadsheetId()     // IDを取得
2. CONFIG設定を更新               // 設定を更新  
3. quickSetup()                  // 自動セットアップ

// 🎉 完了！レポートが生成されます
```

---

**📝 注意**: 初回セットアップ時は必ず`testReport()`でテスト実行を行い、期待通りの結果が得られることを確認してください。データの品質がレポートの精度に大きく影響します。