# 📋 セットアップガイド - 既存スプレッドシート対応

このガイドでは、既存のスプレッドシートを使用してレポーティングシステムを設定する方法を説明します。

## 🚀 ステップバイステップセットアップ

### Step 1: 既存スプレッドシートの確認

#### 1.1 スプレッドシートを開く
- 分析したいスプレッドシートを開きます
- データが適切に入力されていることを確認

#### 1.2 データ形式の確認
- ヘッダー行があることを確認
- データが一貫した形式で入力されていることを確認

### Step 2: Google Apps Scriptプロジェクトの作成

#### 2.1 Apps Scriptエディタを開く
1. スプレッドシートで「拡張機能」→「Apps Script」を選択
2. 新しいプロジェクトが作成されます

#### 2.2 ファイルの作成
必要なファイルを作成し、GitHubからコードをコピーします：

```
プロジェクト構造:
├── Code.gs              # メインプログラム
├── SheetAnalyzer.gs     # 構造分析
├── SetupUtilities.gs    # セットアップ用ユーティリティ
└── appsscript.json     # プロジェクト設定
```

### Step 3: 基本設定の実行

#### 3.1 スプレッドシートIDの取得
Apps Scriptエディタで以下を実行：
```javascript
getCurrentSpreadsheetId();
```

実行結果をコピーします。

#### 3.2 設定の更新
`Code.gs`のCONFIG部分を更新：
```javascript
const CONFIG = {
  SPREADSHEET_ID: 'YOUR_COPIED_SPREADSHEET_ID',  // ← Step 3.1で取得したID
  NOTIFICATION_EMAIL: 'your-email@example.com',   // ← あなたのメールアドレス
  DATA_SHEET_NAME: '',  // 空の場合は最初のシートを使用
  REPORT_SHEET_NAME: 'レポート'
};
```

### Step 4: 自動分析の実行

#### 4.1 クイックセットアップ
```javascript
quickSetup();
```

この関数は以下を実行します：
- スプレッドシートの構造分析
- 列のデータ型自動判定
- 分析結果の表示
- テストレポートの生成

#### 4.2 分析結果の確認
- 「構造分析」シートで分析結果を確認
- 「レポート」シートでテストレポートを確認

### Step 5: カスタマイズ（オプション）

#### 5.1 列のデータ型調整
分析結果が不正確な場合、手動で調整できます：
```javascript
// 例：特定の列をステータス型に変更
// SheetAnalyzer.gs の determineDataType 関数を調整
```

#### 5.2 レポート形式のカスタマイズ
`Code.gs`の`generateReport`関数を修正してレポート形式を変更できます。

### Step 6: 自動実行の設定

#### 6.1 トリガーの設定
```javascript
setupDailyTrigger();
```

#### 6.2 設定の確認
```javascript
checkTriggers();
```

### Step 7: 最終テスト

#### 7.1 完全なセットアップ
```javascript
completeSetup();
```

#### 7.2 手動実行テスト
```javascript
main();
```

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. 権限エラー
```
解決方法：
- Apps Scriptエディタで初回実行時に権限を承認
- スプレッドシートとメール送信権限を許可
```

#### 2. データ型の誤判定
```
解決方法：
- 「構造分析」シートで判定結果を確認
- 必要に応じて SheetAnalyzer.gs を調整
```

#### 3. 空のデータが多い
```
解決方法：
- generateSampleData() でテストデータを追加
- 元データの品質を確認
```

#### 4. レポートが生成されない
```
解決方法：
- checkConfiguration() で設定を確認
- displayStructureInfo() で構造を確認
- testReport() でテスト実行
```

## 📊 データ型の自動判定

システムは以下の基準でデータ型を判定します：

### 日付型 (date)
- ヘッダーに「日付」「期限」「date」などのキーワード
- 60%以上のデータが日付形式

### ステータス型 (status)
- ヘッダーに「ステータス」「状態」「progress」などのキーワード
- ユニークな値が10個以下でステータス関連の値を含む

### カテゴリ型 (category)
- ユニークな値が全体の30%以下
- ユニークな値が10個以下

### 数値型 (number)
- 80%以上のデータが数値

### テキスト型 (text)
- 上記に該当しない場合のデフォルト

## 🎯 推奨されるデータ形式

### 理想的なスプレッドシート構造
```
行1: ヘッダー行
行2以降: データ行

例：
| 日付       | タスク名     | ステータス | 担当者 | 期限       |
| 2024/01/15 | 企画書作成   | 進行中     | 田中   | 2024/01/20 |
| 2024/01/14 | 会議準備     | 完了       | 佐藤   | 2024/01/15 |
```

### データ品質のガイドライン
- 一貫した日付形式を使用
- ステータス値を統一（「完了」「進行中」「未着手」など）
- 空のセルを最小限に抑える
- 数値データは数値形式で入力

## 🔄 定期的なメンテナンス

### 月次チェック項目
1. レポートの内容確認
2. データ品質の確認
3. トリガーの動作確認
4. 新しい列の追加チェック

### 年次チェック項目
1. システムの全般的な見直し
2. 新機能の追加検討
3. データ構造の最適化
4. セキュリティ設定の確認

## 📞 サポート

問題が発生した場合は、以下の順序で確認してください：

1. `showHelp()` - ヘルプ関数の実行
2. `checkConfiguration()` - 設定の確認
3. `displayStructureInfo()` - 構造分析結果の表示
4. ログの確認（Apps Scriptエディタの実行トランスクリプト）

---

**注意**: 初回セットアップ時は必ず`testReport()`でテスト実行を行い、期待通りの結果が得られることを確認してください。